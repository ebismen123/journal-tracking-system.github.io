<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Jeruk Manis ATS - Article Journal Tracker</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        .orange-gradient {
            background: linear-gradient(135deg, #ff8c00 0%, #ffa500 100%);
        }
        .orange-shadow {
            box-shadow: 0 4px 20px rgba(255, 140, 0, 0.3);
        }
        .orange-border {
            border: 2px solid #ff8c00;
        }
        .orange-text-gradient {
            background: linear-gradient(to right, #ff8c00, #ff5e00);
            -webkit-background-clip: text;
            background-clip: text;
            color: transparent;
        }
        .urgent {
            animation: pulse 2s infinite;
        }
        @keyframes pulse {
            0% { box-shadow: 0 0 0 0 rgba(255, 0, 0, 0.4); }
            70% { box-shadow: 0 0 0 10px rgba(255, 0, 0, 0); }
            100% { box-shadow: 0 0 0 0 rgba(255, 0, 0, 0); }
        }
    </style>
</head>
<body class="min-h-screen" style="background-image: url('https://img.freepik.com/premium-vector/seamless-pattern-with-white-outline-oranges-fruit-citrus-orange-color-background_528213-749.jpg'); background-size: 500px; background-opacity: 0.1;">
    <!-- Header with Logo -->
    <header class="orange-gradient text-white py-4 px-6 shadow-lg">
        <div class="container mx-auto flex flex-col md:flex-row items-center justify-between">
            <div class="flex items-center mb-4 md:mb-0">
                <img src="https://img.icons8.com/?size=100&id=XxRdzBNPGyUO&format=png&color=000000" alt="Orange" class="h-8 w-auto mr-3">
                <h1 class="text-2xl md:text-3xl font-bold">Jeruk Manis</h1>
            </div>
            <div class="flex items-center">
                
                <p class="hidden md:block italic">Article Tracking System</p>
            </div>
        </div>
    </header>

    <!-- Main Content -->
    <main class="container mx-auto py-8 px-4">
        <div class="flex flex-col lg:flex-row gap-8">
            <!-- Form Section -->
            <section class="w-full lg:w-1/3 bg-white rounded-xl shadow-lg orange-border p-6">
                <h2 class="text-2xl font-bold mb-6 orange-text-gradient">Journal Submission Form</h2>
                
                <form id="journalForm" class="space-y-4">
                    <div>
                        <label for="entryDate" class="block text-sm font-medium text-gray-700">Tanggal Artikel Masuk</label>
                        <input type="date" id="entryDate" required class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-orange-500 focus:ring focus:ring-orange-200 p-2 border">
                    </div>
                    
                    <div>
                        <label for="authorName" class="block text-sm font-medium text-gray-700">Nama Penulis</label>
                        <input type="text" id="authorName" required class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-orange-500 focus:ring focus:ring-orange-200 p-2 border">
                    </div>
                    
                    <div>
                        <label for="affiliation" class="block text-sm font-medium text-gray-700">Afiliasi</label>
                        <input type="text" id="affiliation" required class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-orange-500 focus:ring focus:ring-orange-200 p-2 border">
                    </div>
                    
                    <div>
                        <label for="title" class="block text-sm font-medium text-gray-700">Judul Artikel</label>
                        <textarea id="title" rows="2" required class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-orange-500 focus:ring focus:ring-orange-200 p-2 border"></textarea>
                    </div>
                    
                    <div>
                        <label for="phone" class="block text-sm font-medium text-gray-700">No HP</label>
                        <input type="tel" id="phone" required class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-orange-500 focus:ring focus:ring-orange-200 p-2 border">
                    </div>
                    
                    <div>
                        <label for="journalTarget" class="block text-sm font-medium text-gray-700">Jurnal yang Dituju</label>
                        <select id="journalTarget" required class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-orange-500 focus:ring focus:ring-orange-200 p-2 border">
                            <option value="">Pilih Jurnal</option>
                            <option value="EBISMEN">EBISMEN</option>
                            <option value="WAWASAN">WAWASAN</option>
                            <option value="PROFIT">PROFIT</option>
                            <option value="POPULER">POPULER</option>
                            <option value="SIDU">SIDU</option>
                            <option value="INSDU">INSDU</option>
                            <option value="OCEAN">OCEAN</option>
                            <option value="KTI">KTI</option>
                        </select>
                    </div>
                    
                    <div>
                        <label for="deadline" class="block text-sm font-medium text-gray-700">Tanggal Deadline</label>
                        <input type="date" id="deadline" required class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-orange-500 focus:ring focus:ring-orange-200 p-2 border">
                    </div>
                    
                    <div>
                        <label class="block text-sm font-medium text-gray-700">Proses</label>
                        <div class="mt-2 space-y-2">
                            <div class="flex items-center">
                                <input id="submitted" name="process" type="radio" value="Sudah disubmit" class="h-4 w-4 text-orange-600 focus:ring-orange-500">
                                <label for="submitted" class="ml-2 block text-sm text-gray-700">Sudah disubmit</label>
                            </div>
                            <div class="flex items-center">
                                <input id="notSubmitted" name="process" type="radio" value="Belum submit" checked class="h-4 w-4 text-orange-600 focus:ring-orange-500">
                                <label for="notSubmitted" class="ml-2 block text-sm text-gray-700">Belum submit</label>
                            </div>
                            <div class="flex items-center">
                                <input id="review" name="process" type="radio" value="Review" class="h-4 w-4 text-orange-600 focus:ring-orange-500">
                                <label for="review" class="ml-2 block text-sm text-gray-700">Review</label>
                            </div>
                            <div class="flex items-center">
                                <input id="editing" name="process" type="radio" value="Editing" class="h-4 w-4 text-orange-600 focus:ring-orange-500">
                                <label for="editing" class="ml-2 block text-sm text-gray-700">Editing</label>
                            </div>
                            <div class="flex items-center">
                                <input id="publish" name="process" type="radio" value="Publish" class="h-4 w-4 text-orange-600 focus:ring-orange-500">
                                <label for="publish" class="ml-2 block text-sm text-gray-700">Publish</label>
                            </div>
                        </div>
                    </div>
                    
                    <div>
                        <label class="block text-sm font-medium text-gray-700">Status Pembayaran</label>
                        <div class="mt-2 space-y-2">
                            <div class="flex items-center">
                                <input id="paid" name="payment" type="radio" value="Sudah Bayar" class="h-4 w-4 text-orange-600 focus:ring-orange-500">
                                <label for="paid" class="ml-2 block text-sm text-gray-700">Sudah Bayar</label>
                            </div>
                            <div class="flex items-center">
                                <input id="notPaid" name="payment" type="radio" value="Belum Bayar" checked class="h-4 w-4 text-orange-600 focus:ring-orange-500">
                                <label for="notPaid" class="ml-2 block text-sm text-gray-700">Belum Bayar</label>
                            </div>
                        </div>
                    </div>
                    
                    <div class="pt-4">
                        <button type="submit" class="w-full orange-gradient text-white py-2 px-4 rounded-md hover:bg-orange-600 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-orange-500 font-medium">
                            <i class="fas fa-save mr-2"></i> Simpan Data
                        </button>
                    </div>
                </form>
            </section>
            
            <!-- Report Section -->
            <section class="w-full lg:w-2/3">
                <div class="bg-white rounded-xl shadow-lg orange-border p-6">
                    <div class="flex justify-between items-center mb-6">
                        <h2 class="text-2xl font-bold orange-text-gradient">Journal Tracking Report</h2>
                        <div class="flex items-center bg-orange-100 px-3 py-1 rounded-full">
                            <i class="fas fa-chart-line text-orange-500 mr-2"></i>
                            <span class="text-sm font-medium text-orange-800">Live Data</span>
                        </div>
                    </div>
                    
                    <div class="mb-4">
                        <div class="relative">
                            <input type="text" id="searchInput" placeholder="Cari berdasarkan nama penulis atau judul..." class="w-full pl-10 pr-4 py-2 rounded-lg border border-gray-300 focus:outline-none focus:ring-2 focus:ring-orange-500 focus:border-orange-500">
                            <div class="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none">
                                <i class="fas fa-search text-gray-400"></i>
                            </div>
                        </div>
                    </div>
                    
                    <div class="overflow-x-auto">
                        <table class="min-w-full divide-y divide-gray-200">
                            <thead class="bg-orange-50">
                                <tr>
                                    <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-orange-800 uppercase tracking-wider">Penulis</th>
                                    <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-orange-800 uppercase tracking-wider">Judul</th>
                                    <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-orange-800 uppercase tracking-wider">Jurnal</th>
                                    <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-orange-800 uppercase tracking-wider">Deadline</th>
                                    <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-orange-800 uppercase tracking-wider">Status</th>
                                    <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-orange-800 uppercase tracking-wider">Aksi</th>
                                </tr>
                            </thead>
                            <tbody id="journalList" class="bg-white divide-y divide-gray-200">
                                <!-- Data will be inserted here by JavaScript -->
                            </tbody>
                        </table>
                    </div>
                    
                    <div id="noData" class="text-center py-8 hidden">
                        <i class="fas fa-book-open text-4xl text-orange-300 mb-4"></i>
                        <h3 class="text-lg font-medium text-gray-700">Belum ada data jurnal</h3>
                        <p class="text-gray-500 mt-1">Mulai dengan menambahkan data jurnal melalui form di samping</p>
                    </div>
                </div>
            </section>
        </div>
    </main>

    <!-- Modal for Edit -->
    <div id="editModal" class="fixed inset-0 z-50 hidden overflow-y-auto">
        <div class="flex items-center justify-center min-h-screen pt-4 px-4 pb-20 text-center sm:block sm:p-0">
            <div class="fixed inset-0 transition-opacity" aria-hidden="true">
                <div class="absolute inset-0 bg-gray-500 opacity-75"></div>
            </div>
            <span class="hidden sm:inline-block sm:align-middle sm:h-screen" aria-hidden="true">&#8203;</span>
            <div class="inline-block align-bottom bg-white rounded-lg text-left overflow-hidden shadow-xl transform transition-all sm:my-8 sm:align-middle sm:max-w-lg sm:w-full">
                <div class="bg-white px-4 pt-5 pb-4 sm:p-6 sm:pb-4">
                    <h3 class="text-lg leading-6 font-medium text-gray-900 mb-4" id="modalTitle">Edit Data Jurnal</h3>
                    <form id="editForm">
                        <input type="hidden" id="editId">
                        <div class="mb-4">
                            <label for="editEntryDate" class="block text-sm font-medium text-gray-700">Tanggal Artikel Masuk</label>
                            <input type="date" id="editEntryDate" required class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-orange-500 focus:ring focus:ring-orange-200 p-2 border">
                        </div>
                        
                        <div class="mb-4">
                            <label for="editAuthorName" class="block text-sm font-medium text-gray-700">Nama Penulis</label>
                            <input type="text" id="editAuthorName" required class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-orange-500 focus:ring focus:ring-orange-200 p-2 border">
                        </div>
                        
                        <div class="mb-4">
                            <label for="editAffiliation" class="block text-sm font-medium text-gray-700">Afiliasi</label>
                            <input type="text" id="editAffiliation" required class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-orange-500 focus:ring focus:ring-orange-200 p-2 border">
                        </div>
                        
                        <div class="mb-4">
                            <label for="editTitle" class="block text-sm font-medium text-gray-700">Judul Artikel</label>
                            <textarea id="editTitle" rows="2" required class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-orange-500 focus:ring focus:ring-orange-200 p-2 border"></textarea>
                        </div>
                        
                        <div class="mb-4">
                            <label for="editPhone" class="block text-sm font-medium text-gray-700">No HP</label>
                            <input type="tel" id="editPhone" required class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-orange-500 focus:ring focus:ring-orange-200 p-2 border">
                        </div>
                        
                        <div class="mb-4">
                            <label for="editJournalTarget" class="block text-sm font-medium text-gray-700">Jurnal yang Dituju</label>
                            <select id="editJournalTarget" required class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-orange-500 focus:ring focus:ring-orange-200 p-2 border">
                                <option value="">Pilih Jurnal</option>
                                <option value="EBISMEN">EBISMEN</option>
                                <option value="WAWASAN">WAWASAN</option>
                                <option value="PROFIT">PROFIT</option>
                                <option value="POPULER">POPULER</option>
                                <option value="SIDU">SIDU</option>
                                <option value="INSDU">INSDU</option>
                                <option value="OCEAN">OCEAN</option>
                                <option value="KTI">KTI</option>
                            </select>
                        </div>
                        
                        <div class="mb-4">
                            <label for="editDeadline" class="block text-sm font-medium text-gray-700">Tanggal Deadline</label>
                            <input type="date" id="editDeadline" required class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-orange-500 focus:ring focus:ring-orange-200 p-2 border">
                        </div>
                        
                        <div class="mb-4">
                            <label class="block text-sm font-medium text-gray-700">Proses</label>
                            <div class="mt-2 space-y-2">
                                <div class="flex items-center">
                                    <input id="editSubmitted" name="editProcess" type="radio" value="Sudah disubmit" class="h-4 w-4 text-orange-600 focus:ring-orange-500">
                                    <label for="editSubmitted" class="ml-2 block text-sm text-gray-700">Sudah disubmit</label>
                                </div>
                                <div class="flex items-center">
                                    <input id="editNotSubmitted" name="editProcess" type="radio" value="Belum submit" class="h-4 w-4 text-orange-600 focus:ring-orange-500">
                                    <label for="editNotSubmitted" class="ml-2 block text-sm text-gray-700">Belum submit</label>
                                </div>
                                <div class="flex items-center">
                                    <input id="editReview" name="editProcess" type="radio" value="Review" class="h-4 w-4 text-orange-600 focus:ring-orange-500">
                                    <label for="editReview" class="ml-2 block text-sm text-gray-700">Review</label>
                                </div>
                                <div class="flex items-center">
                                    <input id="editEditing" name="editProcess" type="radio" value="Editing" class="h-4 w-4 text-orange-600 focus:ring-orange-500">
                                    <label for="editEditing" class="ml-2 block text-sm text-gray-700">Editing</label>
                                </div>
                                <div class="flex items-center">
                                    <input id="editPublish" name="editProcess" type="radio" value="Publish" class="h-4 w-4 text-orange-600 focus:ring-orange-500">
                                    <label for="editPublish" class="ml-2 block text-sm text-gray-700">Publish</label>
                                </div>
                            </div>
                        </div>
                        
                        <div class="mb-4">
                            <label class="block text-sm font-medium text-gray-700">Status Pembayaran</label>
                            <div class="mt-2 space-y-2">
                                <div class="flex items-center">
                                    <input id="editPaid" name="editPayment" type="radio" value="Sudah Bayar" class="h-4 w-4 text-orange-600 focus:ring-orange-500">
                                    <label for="editPaid" class="ml-2 block text-sm text-gray-700">Sudah Bayar</label>
                                </div>
                                <div class="flex items-center">
                                    <input id="editNotPaid" name="editPayment" type="radio" value="Belum Bayar" class="h-4 w-4 text-orange-600 focus:ring-orange-500">
                                    <label for="editNotPaid" class="ml-2 block text-sm text-gray-700">Belum Bayar</label>
                                </div>
                            </div>
                        </div>
                    </form>
                </div>
                <div class="bg-gray-50 px-4 py-3 sm:px-6 sm:flex sm:flex-row-reverse">
                    <button type="button" id="saveEdit" class="w-full inline-flex justify-center rounded-md border border-transparent shadow-sm px-4 py-2 orange-gradient text-base font-medium text-white hover:bg-orange-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-orange-500 sm:ml-3 sm:w-auto sm:text-sm">
                        <i class="fas fa-save mr-2"></i> Simpan Perubahan
                    </button>
                    <button type="button" id="deleteJournal" class="w-full inline-flex justify-center rounded-md border border-transparent shadow-sm px-4 py-2 bg-red-600 text-base font-medium text-white hover:bg-red-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-red-500 sm:ml-3 sm:w-auto sm:text-sm">
                        <i class="fas fa-trash mr-2"></i> Hapus Data
                    </button>
                    <button type="button" id="cancelEdit" class="mt-3 w-full inline-flex justify-center rounded-md border border-gray-300 shadow-sm px-4 py-2 bg-white text-base font-medium text-gray-700 hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-orange-500 sm:mt-0 sm:ml-3 sm:w-auto sm:text-sm">
                        <i class="fas fa-times mr-2"></i> Batal
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Confirmation Modal -->
    <div id="confirmModal" class="fixed inset-0 z-50 hidden overflow-y-auto">
        <div class="flex items-center justify-center min-h-screen pt-4 px-4 pb-20 text-center sm:block sm:p-0">
            <div class="fixed inset-0 transition-opacity" aria-hidden="true">
                <div class="absolute inset-0 bg-gray-500 opacity-75"></div>
            </div>
            <span class="hidden sm:inline-block sm:align-middle sm:h-screen" aria-hidden="true">&#8203;</span>
            <div class="inline-block align-bottom bg-white rounded-lg text-left overflow-hidden shadow-xl transform transition-all sm:my-8 sm:align-middle sm:max-w-lg sm:w-full">
                <div class="bg-white px-4 pt-5 pb-4 sm:p-6 sm:pb-4">
                    <div class="sm:flex sm:items-start">
                        <div class="mx-auto flex-shrink-0 flex items-center justify-center h-12 w-12 rounded-full bg-red-100 sm:mx-0 sm:h-10 sm:w-10">
                            <i class="fas fa-exclamation-triangle text-red-600"></i>
                        </div>
                        <div class="mt-3 text-center sm:mt-0 sm:ml-4 sm:text-left">
                            <h3 class="text-lg leading-6 font-medium text-gray-900" id="modalTitle">Konfirmasi Hapus</h3>
                            <div class="mt-2">
                                <p class="text-sm text-gray-500">Apakah Anda yakin ingin menghapus data jurnal ini? Tindakan ini tidak dapat dibatalkan.</p>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="bg-gray-50 px-4 py-3 sm:px-6 sm:flex sm:flex-row-reverse">
                    <button type="button" id="confirmDelete" class="w-full inline-flex justify-center rounded-md border border-transparent shadow-sm px-4 py-2 bg-red-600 text-base font-medium text-white hover:bg-red-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-red-500 sm:ml-3 sm:w-auto sm:text-sm">
                        <i class="fas fa-trash mr-2"></i> Ya, Hapus
                    </button>
                    <button type="button" id="cancelDelete" class="mt-3 w-full inline-flex justify-center rounded-md border border-gray-300 shadow-sm px-4 py-2 bg-white text-base font-medium text-gray-700 hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-orange-500 sm:mt-0 sm:ml-3 sm:w-auto sm:text-sm">
                        <i class="fas fa-times mr-2"></i> Batal
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Footer -->
    <footer class="bg-orange-900 text-white py-6 mt-8">
        <div class="container mx-auto px-4">
            <div class="flex flex-col md:flex-row justify-between items-center">
                <div class="mb-4 md:mb-0">
                    <div class="flex items-center">
                        <i class="fas fa-book text-2xl mr-2"></i>
                        <span class="text-xl font-bold">Jeruk Manis ATS</span>
                    </div>
                    <p class="text-orange-200 mt-1">Aplikasi Khusus Buat Editor Jurnal</p>
                </div>
                <div class="flex space-x-4">
                    <a href="#" class="text-orange-200 hover:text-white">
                        <i class="fab fa-whatsapp text-xl"></i>
                    </a>
                    <a href="#" class="text-orange-200 hover:text-white">
                        <i class="fas fa-envelope text-xl"></i>
                    </a>
                    <a href="#" class="text-orange-200 hover:text-white">
                        <i class="fas fa-phone text-xl"></i>
                    </a>
                </div>
            </div>
            <div class="border-t border-orange-800 mt-4 pt-4 text-center text-orange-300 text-sm">
                &copy; 2025 Jeruk Manis ATS - Journal Tracker. All rights reserved.
            </div>
        </div>
    </footer>

    <script>
        // Firebase configuration
        const firebaseConfig = {
            apiKey: "AIzaSyAA5ylO4TMtGnnPhrm1vGUDF6AafNSrOUQ",
            authDomain: "orange-journal-tracker.firebaseapp.com",
            databaseURL: "https://orange-journal-tracker-default-rtdb.asia-southeast1.firebasedatabase.app",
            projectId: "orange-journal-tracker",
            storageBucket: "orange-journal-tracker.firebasestorage.app",
            messagingSenderId: "430973783779",
            appId: "1:430973783779:web:bc1ccf3b75ce8144fcffd6"
        };

        // Initialize Firebase
        firebase.initializeApp(firebaseConfig);
        const database = firebase.database();
        const journalsRef = database.ref('journals');

        // DOM elements
        const journalForm = document.getElementById('journalForm');
        const journalList = document.getElementById('journalList');
        const noData = document.getElementById('noData');
        const searchInput = document.getElementById('searchInput');
        const editModal = document.getElementById('editModal');
        const editForm = document.getElementById('editForm');
        const saveEdit = document.getElementById('saveEdit');
        const deleteJournal = document.getElementById('deleteJournal');
        const cancelEdit = document.getElementById('cancelEdit');
        const editId = document.getElementById('editId');
        const confirmModal = document.getElementById('confirmModal');
        const confirmDelete = document.getElementById('confirmDelete');
        const cancelDelete = document.getElementById('cancelDelete');

        // Form submission
        journalForm.addEventListener('submit', (e) => {
            e.preventDefault();
            
            const entryDate = document.getElementById('entryDate').value;
            const authorName = document.getElementById('authorName').value;
            const affiliation = document.getElementById('affiliation').value;
            const title = document.getElementById('title').value;
            const phone = document.getElementById('phone').value;
            const journalTarget = document.getElementById('journalTarget').value;
            const deadline = document.getElementById('deadline').value;
            const process = document.querySelector('input[name="process"]:checked').value;
            const payment = document.querySelector('input[name="payment"]:checked').value;
            
            // Save to Firebase
            const newJournalRef = journalsRef.push();
            newJournalRef.set({
                entryDate,
                authorName,
                affiliation,
                title,
                phone,
                journalTarget,
                deadline,
                process,
                payment,
                createdAt: firebase.database.ServerValue.TIMESTAMP
            });
            
            // Reset form
            journalForm.reset();
            document.getElementById('notSubmitted').checked = true;
            document.getElementById('notPaid').checked = true;
            
            // Show success message
            alert('Data jurnal berhasil disimpan!');
        });

        // Load data from Firebase with sorting
        journalsRef.on('value', (snapshot) => {
            journalList.innerHTML = '';
            const journals = snapshot.val();
            
            if (!journals) {
                noData.classList.remove('hidden');
                return;
            }
            
            noData.classList.add('hidden');
            
            // Convert to array and sort
            const journalsArray = Object.keys(journals).map(key => ({
                id: key,
                ...journals[key]
            }));
            
            // Sort by:
            // 1. Priority: Not published and not paid first
            // 2. Then by closest deadline
            journalsArray.sort((a, b) => {
                // Priority for unfinished/pending items
                const aPriority = (a.process !== 'Publish' || a.payment !== 'Sudah Bayar') ? 1 : 0;
                const bPriority = (b.process !== 'Publish' || b.payment !== 'Sudah Bayar') ? 1 : 0;
                
                if (aPriority !== bPriority) {
                    return bPriority - aPriority; // Higher priority first
                }
                
                // Then sort by deadline (closest first)
                const aDeadline = new Date(a.deadline).getTime();
                const bDeadline = new Date(b.deadline).getTime();
                return aDeadline - bDeadline;
            });
            
            // Add rows in sorted order
            journalsArray.forEach(journal => {
                const row = createJournalRow(journal.id, journal);
                journalList.appendChild(row);
            });
        });

        // Create journal row for table
        function createJournalRow(key, journal) {
            const row = document.createElement('tr');
            row.className = 'hover:bg-orange-50 bg-white bg-opacity-90';
            row.dataset.id = key;
            
            // Check if deadline is within 1 day and status is not "Publish"
            const today = new Date();
            const deadlineDate = new Date(journal.deadline);
            const timeDiff = deadlineDate.getTime() - today.getTime();
            const daysDiff = Math.ceil(timeDiff / (1000 * 3600 * 24));
            const isUrgent = daysDiff <= 1 && daysDiff >= 0 && journal.process !== 'Publish';
            
            // Status badge
            let statusClass = '';
            switch(journal.process) {
                case 'Sudah disubmit':
                    statusClass = 'bg-blue-100 text-blue-800';
                    break;
                case 'Belum submit':
                    statusClass = 'bg-gray-100 text-gray-800';
                    break;
                case 'Review':
                    statusClass = 'bg-yellow-100 text-yellow-800';
                    break;
                case 'Editing':
                    statusClass = 'bg-purple-100 text-purple-800';
                    break;
                case 'Publish':
                    statusClass = 'bg-green-100 text-green-800';
                    break;
            }
            
            // Payment badge
            const paymentClass = journal.payment === 'Sudah Bayar' ? 'bg-green-100 text-green-800' : 'bg-red-100 text-red-800';
            
            // Deadline cell with urgent indicator
            let deadlineCell = '';
            if (isUrgent) {
                deadlineCell = `
                    <div class="flex items-center">
                        <span class="mr-2">${journal.deadline}</span>
                        <span class="h-2 w-2 rounded-full bg-red-500 urgent"></span>
                    </div>
                `;
            } else if (daysDiff < 0 && journal.process !== 'Publish') {
                deadlineCell = `
                    <div class="flex items-center text-red-500">
                        <span class="mr-2">${journal.deadline}</span>
                        <span class="text-xs">(Terlambat)</span>
                    </div>
                `;
            } else {
                deadlineCell = journal.deadline;
            }
            
            row.innerHTML = `
                <td class="px-6 py-4 whitespace-nowrap">
                    <div class="flex items-center">
                        <div class="flex-shrink-0 h-10 w-10 rounded-full bg-orange-100 flex items-center justify-center">
                            <i class="fas fa-user text-orange-500"></i>
                        </div>
                        <div class="ml-4">
                            <div class="text-sm font-medium text-gray-900">${journal.authorName}</div>
                            <div class="text-sm text-gray-500">${journal.affiliation}</div>
                        </div>
                    </div>
                </td>
                <td class="px-6 py-4">
                    <div class="text-sm text-gray-900 font-medium">${journal.title.substring(0, 30)}${journal.title.length > 30 ? '...' : ''}</div>
                    <div class="text-xs text-gray-500">${journal.entryDate}</div>
                </td>
                <td class="px-6 py-4 whitespace-nowrap">
                    <span class="px-2 inline-flex text-xs leading-5 font-semibold rounded-full bg-orange-100 text-orange-800">
                        ${journal.journalTarget}
                    </span>
                </td>
                <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">
                    ${deadlineCell}
                </td>
                <td class="px-6 py-4 whitespace-nowrap">
                    <span class="px-2 inline-flex text-xs leading-5 font-semibold rounded-full ${statusClass}">
                        ${journal.process}
                    </span>
                    <span class="mt-1 block px-2 inline-flex text-xs leading-5 font-semibold rounded-full ${paymentClass}">
                        ${journal.payment}
                    </span>
                </td>
                <td class="px-6 py-4 whitespace-nowrap text-right text-sm font-medium">
                    <div class="flex space-x-2">
                        <button onclick="editJournal('${key}')" class="text-orange-600 hover:text-orange-900" title="Edit">
                            <i class="fas fa-edit"></i>
                        </button>
                        <a href="https://wa.me/${journal.phone.replace(/^0/, '62')}" target="_blank" class="text-green-600 hover:text-green-900" title="WhatsApp">
                            <i class="fab fa-whatsapp"></i>
                        </a>
                        <button onclick="createLOA('${journal.journalTarget}')" class="text-blue-600 hover:text-blue-900" title="Buat LoA">
                            <i class="fas fa-file-alt"></i>
                        </button>
                        <button onclick="showDeleteConfirm('${key}')" class="text-red-600 hover:text-red-900" title="Hapus">
                            <i class="fas fa-trash"></i>
                        </button>
                    </div>
                </td>
            `;
            
            return row;
        }

        // Edit journal
        function editJournal(id) {
            journalsRef.child(id).once('value', (snapshot) => {
                const journal = snapshot.val();
                
                editId.value = id;
                document.getElementById('editEntryDate').value = journal.entryDate;
                document.getElementById('editAuthorName').value = journal.authorName;
                document.getElementById('editAffiliation').value = journal.affiliation;
                document.getElementById('editTitle').value = journal.title;
                document.getElementById('editPhone').value = journal.phone;
                document.getElementById('editJournalTarget').value = journal.journalTarget;
                document.getElementById('editDeadline').value = journal.deadline;
                document.querySelector(`input[name="editProcess"][value="${journal.process}"]`).checked = true;
                document.querySelector(`input[name="editPayment"][value="${journal.payment}"]`).checked = true;
                
                editModal.classList.remove('hidden');
            });
        }

        // Save edited journal
        saveEdit.addEventListener('click', () => {
            const id = editId.value;
            const entryDate = document.getElementById('editEntryDate').value;
            const authorName = document.getElementById('editAuthorName').value;
            const affiliation = document.getElementById('editAffiliation').value;
            const title = document.getElementById('editTitle').value;
            const phone = document.getElementById('editPhone').value;
            const journalTarget = document.getElementById('editJournalTarget').value;
            const deadline = document.getElementById('editDeadline').value;
            const process = document.querySelector('input[name="editProcess"]:checked').value;
            const payment = document.querySelector('input[name="editPayment"]:checked').value;
            
            journalsRef.child(id).update({
                entryDate,
                authorName,
                affiliation,
                title,
                phone,
                journalTarget,
                deadline,
                process,
                payment
            }, (error) => {
                if (error) {
                    alert('Gagal memperbarui data: ' + error.message);
                } else {
                    editModal.classList.add('hidden');
                    alert('Data berhasil diperbarui!');
                }
            });
        });

        // Show delete confirmation
        function showDeleteConfirm(id) {
            editId.value = id;
            confirmModal.classList.remove('hidden');
        }

        // Confirm delete
        confirmDelete.addEventListener('click', () => {
            const id = editId.value;
            
            journalsRef.child(id).remove()
                .then(() => {
                    confirmModal.classList.add('hidden');
                    alert('Data berhasil dihapus!');
                })
                .catch(error => {
                    alert('Gagal menghapus data: ' + error.message);
                });
        });

        // Cancel delete
        cancelDelete.addEventListener('click', () => {
            confirmModal.classList.add('hidden');
        });

        // Cancel edit
        cancelEdit.addEventListener('click', () => {
            editModal.classList.add('hidden');
        });

        // Search functionality
        searchInput.addEventListener('input', (e) => {
            const searchTerm = e.target.value.toLowerCase();
            const rows = journalList.querySelectorAll('tr');
            
            rows.forEach(row => {
                const author = row.querySelector('td:first-child div div:first-child').textContent.toLowerCase();
                const title = row.querySelector('td:nth-child(2) div:first-child').textContent.toLowerCase();
                
                if (author.includes(searchTerm) || title.includes(searchTerm)) {
                    row.style.display = '';
                } else {
                    row.style.display = 'none';
                }
            });
        });

        // Create LOA document
        function createLOA(journal) {
            // Replace with actual Google Docs template URLs for each journal
            const templates = {
                'EBISMEN': 'https://docs.google.com/document/d/EBISMEN_TEMPLATE_ID/edit',
                'WAWASAN': 'https://docs.google.com/document/d/WAWASAN_TEMPLATE_ID/edit',
                'PROFIT': 'https://docs.google.com/document/d/PROFIT_TEMPLATE_ID/edit',
                'POPULER': 'https://docs.google.com/document/d/POPULER_TEMPLATE_ID/edit',
                'SIDU': 'https://docs.google.com/document/d/SIDU_TEMPLATE_ID/edit',
                'INSDU': 'https://docs.google.com/document/d/INSDU_TEMPLATE_ID/edit',
                'OCEAN': 'https://docs.google.com/document/d/OCEAN_TEMPLATE_ID/edit',
                'KTI': 'https://docs.google.com/document/d/KTI_TEMPLATE_ID/edit'
            };
            
            if (templates[journal]) {
                window.open(templates[journal], '_blank');
            } else {
                alert('Template LoA untuk jurnal ini belum tersedia.');
            }
        }

        // Initialize date fields with today's date
        window.onload = function() {
            const today = new Date().toISOString().split('T')[0];
            document.getElementById('entryDate').value = today;
            
            // Set deadline to 7 days from today
            const nextWeek = new Date();
            nextWeek.setDate(nextWeek.getDate() + 7);
            document.getElementById('deadline').value = nextWeek.toISOString().split('T')[0];
        };
    </script>
</body>
</html>
