<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Jeruk Manis ATS - Article Journal Tracker</title>
    <script src="https://cdn.tailwindcss.com/"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        .orange-gradient {
            background: linear-gradient(135deg, #ff8c00 0%, #ffa500 100%);
        }
        .orange-shadow {
            box-shadow: 0 4px 20px rgba(255, 140, 0, 0.3);
        }
        .orange-border {
            border: 2px solid #ff8c00;
        }
        .orange-text-gradient {
            background: linear-gradient(to right, #ff8c00, #ff5e00);
            -webkit-background-clip: text;
            background-clip: text;
            color: transparent;
        }
        .urgent {
            animation: pulse 1.5s infinite;
        }
        @keyframes pulse {
            0% { box-shadow: 0 0 0 0 rgba(255, 0, 0, 0.5); }
            70% { box-shadow: 0 0 0 10px rgba(255, 0, 0, 0); }
            100% { box-shadow: 0 0 0 0 rgba(255, 0, 0, 0); }
        }
    </style>
</head>
<body class="min-h-screen bg-gray-50" style="background-image: url('https://img.freepik.com/premium-vector/seamless-pattern-with-white-outline-oranges-fruit-citrus-orange-color-background_528213-749.jpg'); background-size: 500px; background-repeat: repeat;">

    <!-- Header with Logo -->
    <header class="orange-gradient text-white py-3 px-4 shadow-lg sticky top-0 z-40">
        <div class="container mx-auto flex items-center justify-between">
            <div class="flex items-center">
                <img src="https://img.icons8.com/?size=100&id=XxRdzBNPGyUO&format=png&color=FFFFFF" alt="Orange" class="h-8 w-auto mr-3">
                <h1 class="text-xl sm:text-2xl font-bold">Jeruk Manis</h1>
            </div>
            <div class="flex items-center">
                 <button id="notificationBtn" class="text-white hover:text-orange-200 mr-4 transition-colors" title="Aktifkan Notifikasi Deadline">
                    <i class="fas fa-bell text-xl"></i>
                </button>
                <p class="hidden sm:block italic text-sm">Article Tracking System</p>
            </div>
        </div>
    </header>

    <!-- Main Content -->
    <main class="container mx-auto py-8 px-4">
        <div class="flex flex-col lg:flex-row gap-8">
            <!-- Form Section -->
            <section class="w-full lg:w-1/3 bg-white rounded-xl shadow-lg orange-border p-6 h-fit">
                <h2 class="text-2xl font-bold mb-6 orange-text-gradient">Journal Submission Form</h2>
                
                <form id="journalForm" class="space-y-4">
                    <div>
                        <label for="entryDate" class="block text-sm font-medium text-gray-700">Tanggal Artikel Masuk</label>
                        <input type="date" id="entryDate" required class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-orange-500 focus:ring focus:ring-orange-200 p-2 border">
                    </div>
                    
                    <div>
                        <label for="authorName" class="block text-sm font-medium text-gray-700">Nama Penulis</label>
                        <input type="text" id="authorName" required class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-orange-500 focus:ring focus:ring-orange-200 p-2 border">
                    </div>
                    
                    <div>
                        <label for="affiliation" class="block text-sm font-medium text-gray-700">Afiliasi</label>
                        <input type="text" id="affiliation" required class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-orange-500 focus:ring focus:ring-orange-200 p-2 border">
                    </div>
                    
                    <div>
                        <label for="title" class="block text-sm font-medium text-gray-700">Judul Artikel</label>
                        <textarea id="title" rows="2" required class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-orange-500 focus:ring focus:ring-orange-200 p-2 border"></textarea>
                    </div>

                    <div>
                        <label for="articleNumber" class="block text-sm font-medium text-gray-700">Nomor Artikel</label>
                        <input type="text" id="articleNumber" required class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-orange-500 focus:ring focus:ring-orange-200 p-2 border">
                    </div>

                    <div class="grid grid-cols-2 gap-4">
                        <div>
                            <label for="volume" class="block text-sm font-medium text-gray-700">Volume</label>
                            <input type="number" id="volume" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-orange-500 focus:ring focus:ring-orange-200 p-2 border">
                        </div>
                        <div>
                            <label for="issueNumber" class="block text-sm font-medium text-gray-700">Nomor (Terbitan)</label>
                            <input type="number" id="issueNumber" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-orange-500 focus:ring focus:ring-orange-200 p-2 border">
                        </div>
                    </div>

                    <div class="grid grid-cols-2 gap-4">
                        <div>
                            <label for="publishMonth" class="block text-sm font-medium text-gray-700">Bulan Terbit</label>
                            <select id="publishMonth" required class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-orange-500 focus:ring focus:ring-orange-200 p-2 border">
                                <option value="Januari">Januari</option>
                                <option value="Februari">Februari</option>
                                <option value="Maret">Maret</option>
                                <option value="April">April</option>
                                <option value="Mei">Mei</option>
                                <option value="Juni">Juni</option>
                                <option value="Juli">Juli</option>
                                <option value="Agustus">Agustus</option>
                                <option value="September">September</option>
                                <option value="Oktober">Oktober</option>
                                <option value="November">November</option>
                                <option value="Desember">Desember</option>
                            </select>
                        </div>
                        <div>
                            <label for="publishYear" class="block text-sm font-medium text-gray-700">Tahun Terbit</label>
                            <input type="number" id="publishYear" required class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-orange-500 focus:ring focus:ring-orange-200 p-2 border" placeholder="2025">
                        </div>
                    </div>
                    
                    <div>
                        <label for="phone" class="block text-sm font-medium text-gray-700">No HP</label>
                        <input type="tel" id="phone" required class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-orange-500 focus:ring focus:ring-orange-200 p-2 border">
                    </div>

                    <div>
                        <label for="publicationType" class="block text-sm font-medium text-gray-700">Jenis Publikasi</label>
                        <select id="publicationType" required class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-orange-500 focus:ring focus:ring-orange-200 p-2 border">
                            <option value="Reguler">Reguler (8 Hari) - 100rb</option>
                            <option value="Fast Track">Fast Track (2 Hari) - 200rb</option>
                        </select>
                    </div>
                    
                    <div>
                        <label for="journalTarget" class="block text-sm font-medium text-gray-700">Jurnal yang Dituju</label>
                        <select id="journalTarget" required class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-orange-500 focus:ring focus:ring-orange-200 p-2 border">
                            <option value="">Pilih Jurnal</option>
                            <option value="EBISMEN">EBISMEN</option>
                            <option value="WAWASAN">WAWASAN</option>
                            <option value="PROFIT">PROFIT</option>
                            <option value="POPULER">POPULER</option>
                            <option value="SIDU">SIDU</option>
                            <option value="INSDU">INSDU</option>
                            <option value="OCEAN">OCEAN</option>
                            <option value="KTI">KTI</option>
                            <option value="SEJAHTERA">SEJAHTERA</option>
                            <option value="KARUNIA">KARUNIA</option>
                        </select>
                    </div>
                    
                    <div>
                        <label for="deadline" class="block text-sm font-medium text-gray-700">Tanggal Deadline</label>
                        <input type="date" id="deadline" required class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-orange-500 focus:ring focus:ring-orange-200 p-2 border">
                    </div>
                    
                    <div>
                        <label class="block text-sm font-medium text-gray-700">Proses</label>
                        <div class="mt-2 space-y-2">
                            <div class="flex items-center">
                                <input id="notSubmitted" name="process" type="radio" value="Belum submit" checked class="h-4 w-4 text-orange-600 focus:ring-orange-500">
                                <label for="notSubmitted" class="ml-2 block text-sm text-gray-700">Belum submit</label>
                            </div>
                            <div class="flex items-center">
                                <input id="submitted" name="process" type="radio" value="Sudah disubmit" class="h-4 w-4 text-orange-600 focus:ring-orange-500">
                                <label for="submitted" class="ml-2 block text-sm text-gray-700">Sudah disubmit</label>
                            </div>
                            <div class="flex items-center">
                                <input id="review" name="process" type="radio" value="Review" class="h-4 w-4 text-orange-600 focus:ring-orange-500">
                                <label for="review" class="ml-2 block text-sm text-gray-700">Review</label>
                            </div>
                            <div class="flex items-center">
                                <input id="editing" name="process" type="radio" value="Editing" class="h-4 w-4 text-orange-600 focus:ring-orange-500">
                                <label for="editing" class="ml-2 block text-sm text-gray-700">Editing</label>
                            </div>
                            <div class="flex items-center">
                                <input id="loaTerbit" name="process" type="radio" value="LoA sudah terbit" class="h-4 w-4 text-orange-600 focus:ring-orange-500">
                                <label for="loaTerbit" class="ml-2 block text-sm text-gray-700">LoA sudah terbit</label>
                            </div>
                            <div class="flex items-center">
                                <input id="publish" name="process" type="radio" value="Publish" class="h-4 w-4 text-orange-600 focus:ring-orange-500">
                                <label for="publish" class="ml-2 block text-sm text-gray-700">Publish</label>
                            </div>
                        </div>
                    </div>
                    
                    <div>
                        <label class="block text-sm font-medium text-gray-700">Status Pembayaran</label>
                        <div class="mt-2 space-y-2">
                            <div class="flex items-center">
                                <input id="paid" name="payment" type="radio" value="Sudah Bayar" class="h-4 w-4 text-orange-600 focus:ring-orange-500">
                                <label for="paid" class="ml-2 block text-sm text-gray-700">Sudah Bayar</label>
                            </div>
                            <div class="flex items-center">
                                <input id="notPaid" name="payment" type="radio" value="Belum Bayar" checked class="h-4 w-4 text-orange-600 focus:ring-orange-500">
                                <label for="notPaid" class="ml-2 block text-sm text-gray-700">Belum Bayar</label>
                            </div>
                        </div>
                    </div>

                    <!-- Billing Timing Option -->
                     <div>
                        <label class="block text-sm font-medium text-gray-700">Waktu Penagihan</label>
                        <div class="mt-2 space-y-2">
                            <div class="flex items-center">
                                <input id="billNow" name="billingTiming" type="radio" value="Sekarang" checked class="h-4 w-4 text-orange-600 focus:ring-orange-500">
                                <label for="billNow" class="ml-2 block text-sm text-gray-700">Sekarang</label>
                            </div>
                            <div class="flex items-center">
                                <input id="billLater" name="billingTiming" type="radio" value="Nanti" class="h-4 w-4 text-orange-600 focus:ring-orange-500">
                                <label for="billLater" class="ml-2 block text-sm text-gray-700">Nanti</label>
                            </div>
                        </div>
                    </div>
                    
                    <div class="pt-4">
                        <button type="submit" class="w-full orange-gradient text-white py-2 px-4 rounded-md hover:opacity-90 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-orange-500 font-medium transition-opacity">
                            <i class="fas fa-save mr-2"></i> Simpan Data
                        </button>
                    </div>
                </form>
            </section>
            
            <!-- Report Section -->
            <section class="w-full lg:w-2/3">
                <div class="bg-white rounded-xl shadow-lg orange-border p-6">
                    <div class="flex flex-col sm:flex-row justify-between items-start sm:items-center mb-6 gap-4">
                        <h2 class="text-2xl font-bold orange-text-gradient">Journal Tracking Report</h2>
                        <div class="flex items-center bg-orange-100 px-3 py-1 rounded-full flex-shrink-0">
                            <i class="fas fa-chart-line text-orange-500 mr-2"></i>
                            <span class="text-sm font-medium text-orange-800">Live Data</span>
                        </div>
                    </div>

                    <!-- Filters -->
                    <div class="space-y-4 mb-4">
                        <div class="relative">
                            <input type="text" id="searchInput" placeholder="Cari berdasarkan nama, judul, atau nomor artikel..." class="w-full pl-10 pr-4 py-2 rounded-lg border border-gray-300 focus:outline-none focus:ring-2 focus:ring-orange-500 focus:border-orange-500">
                            <div class="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none">
                                <i class="fas fa-search text-gray-400"></i>
                            </div>
                        </div>
                        <div class="grid grid-cols-2 md:grid-cols-5 gap-4">
                            <select id="filterType" class="w-full py-2 px-3 rounded-lg border border-gray-300 focus:outline-none focus:ring-2 focus:ring-orange-500">
                                <option value="">Semua Jenis</option>
                                <option value="Reguler">Reguler</option>
                                <option value="Fast Track">Fast Track</option>
                            </select>
                            <select id="filterJournal" class="w-full py-2 px-3 rounded-lg border border-gray-300 focus:outline-none focus:ring-2 focus:ring-orange-500">
                                 <option value="">Semua Jurnal</option>
                                <option value="EBISMEN">EBISMEN</option>
                                <option value="WAWASAN">WAWASAN</option>
                                <option value="PROFIT">PROFIT</option>
                                <option value="POPULER">POPULER</option>
                                <option value="SIDU">SIDU</option>
                                <option value="INSDU">INSDU</option>
                                <option value="OCEAN">OCEAN</option>
                                <option value="KTI">KTI</option>
                                <option value="SEJAHTERA">SEJAHTERA</option>
                                <option value="KARUNIA">KARUNIA</option>
                            </select>
                            <select id="filterStatus" class="w-full py-2 px-3 rounded-lg border border-gray-300 focus:outline-none focus:ring-2 focus:ring-orange-500">
                                <option value="">Semua Status</option>
                                <option value="Belum submit">Belum submit</option>
                                <option value="Sudah disubmit">Sudah disubmit</option>
                                <option value="Review">Review</option>
                                <option value="Editing">Editing</option>
                                <option value="LoA sudah terbit">LoA sudah terbit</option>
                                <option value="Publish">Publish</option>
                            </select>
                            <select id="filterPayment" class="w-full py-2 px-3 rounded-lg border border-gray-300 focus:outline-none focus:ring-2 focus:ring-orange-500">
                                <option value="">Semua Pembayaran</option>
                                <option value="Sudah Bayar">Sudah Bayar</option>
                                <option value="Belum Bayar">Belum Bayar</option>
                            </select>
                            <button id="resetFilters" class="w-full bg-gray-200 text-gray-700 py-2 px-4 rounded-lg hover:bg-gray-300 font-medium col-span-2 md:col-span-1">Reset</button>
                        </div>
                    </div>

                    <div class="overflow-auto" style="max-height: 70vh;">
                        <table class="min-w-full divide-y divide-gray-200">
                            <thead class="bg-orange-50 sticky top-0 z-10">
                                <tr>
                                    <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-orange-800 uppercase tracking-wider">Penulis</th>
                                    <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-orange-800 uppercase tracking-wider">Judul</th>
                                    <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-orange-800 uppercase tracking-wider">Jenis</th>
                                    <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-orange-800 uppercase tracking-wider">Jurnal</th>
                                    <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-orange-800 uppercase tracking-wider">Deadline</th>
                                    <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-orange-800 uppercase tracking-wider">Status</th>
                                    <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-orange-800 uppercase tracking-wider">Aksi</th>
                                </tr>
                            </thead>
                            <tbody id="journalList" class="bg-white divide-y divide-gray-200">
                                <!-- Data will be inserted here by JavaScript -->
                            </tbody>
                        </table>
                    </div>
                    
                    <div id="loadingSpinner" class="text-center py-8 hidden">
                        <i class="fas fa-spinner fa-spin text-4xl text-orange-400"></i>
                        <p class="mt-2 text-gray-600">Memuat data...</p>
                    </div>

                    <div id="noData" class="text-center py-8 hidden">
                        <i class="fas fa-book-open text-4xl text-orange-300 mb-4"></i>
                        <h3 class="text-lg font-medium text-gray-700">Belum ada data jurnal</h3>
                        <p class="text-gray-500 mt-1">Mulai dengan menambahkan data jurnal melalui form di samping.</p>
                    </div>
                </div>
            </section>
        </div>
    </main>

    <!-- Modals -->
    <div id="editModal" class="fixed inset-0 z-50 hidden overflow-y-auto">
        <div class="flex items-center justify-center min-h-screen pt-4 px-4 pb-20 text-center sm:block sm:p-0">
            <div class="fixed inset-0 transition-opacity" aria-hidden="true">
                <div class="absolute inset-0 bg-gray-500 opacity-75"></div>
            </div>
            <span class="hidden sm:inline-block sm:align-middle sm:h-screen" aria-hidden="true">&#8203;</span>
            <div class="inline-block align-bottom bg-white rounded-lg text-left overflow-hidden shadow-xl transform transition-all sm:my-8 sm:align-middle sm:max-w-lg sm:w-full">
                <div class="bg-white px-4 pt-5 pb-4 sm:p-6 sm:pb-4">
                    <h3 class="text-lg leading-6 font-medium text-gray-900 mb-4" id="modalTitle">Edit Data Jurnal</h3>
                    <form id="editForm">
                        <input type="hidden" id="editId">
                        <div class="space-y-4 max-h-[60vh] overflow-y-auto pr-2">
                           <div class="mb-4">
                                <label for="editEntryDate" class="block text-sm font-medium text-gray-700">Tanggal Artikel Masuk</label>
                                <input type="date" id="editEntryDate" required class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-orange-500 focus:ring focus:ring-orange-200 p-2 border">
                            </div>
                            
                            <div class="mb-4">
                                <label for="editAuthorName" class="block text-sm font-medium text-gray-700">Nama Penulis</label>
                                <input type="text" id="editAuthorName" required class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-orange-500 focus:ring focus:ring-orange-200 p-2 border">
                            </div>
                            
                            <div class="mb-4">
                                <label for="editAffiliation" class="block text-sm font-medium text-gray-700">Afiliasi</label>
                                <input type="text" id="editAffiliation" required class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-orange-500 focus:ring focus:ring-orange-200 p-2 border">
                            </div>
                            
                            <div class="mb-4">
                                <label for="editTitle" class="block text-sm font-medium text-gray-700">Judul Artikel</label>
                                <textarea id="editTitle" rows="2" required class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-orange-500 focus:ring focus:ring-orange-200 p-2 border"></textarea>
                            </div>

                            <div class="mb-4">
                                <label for="editArticleNumber" class="block text-sm font-medium text-gray-700">Nomor Artikel</label>
                                <input type="text" id="editArticleNumber" required class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-orange-500 focus:ring focus:ring-orange-200 p-2 border">
                            </div>

                             <div class="grid grid-cols-2 gap-4 mb-4">
                                <div>
                                    <label for="editVolume" class="block text-sm font-medium text-gray-700">Volume</label>
                                    <input type="number" id="editVolume" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-orange-500 focus:ring focus:ring-orange-200 p-2 border">
                                </div>
                                <div>
                                    <label for="editIssueNumber" class="block text-sm font-medium text-gray-700">Nomor (Terbitan)</label>
                                    <input type="number" id="editIssueNumber" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-orange-500 focus:ring focus:ring-orange-200 p-2 border">
                                </div>
                            </div>

                            <div class="grid grid-cols-2 gap-4 mb-4">
                                <div>
                                    <label for="editPublishMonth" class="block text-sm font-medium text-gray-700">Bulan Terbit</label>
                                    <select id="editPublishMonth" required class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-orange-500 focus:ring focus:ring-orange-200 p-2 border">
                                        <option value="Januari">Januari</option>
                                        <option value="Februari">Februari</option>
                                        <option value="Maret">Maret</option>
                                        <option value="April">April</option>
                                        <option value="Mei">Mei</option>
                                        <option value="Juni">Juni</option>
                                        <option value="Juli">Juli</option>
                                        <option value="Agustus">Agustus</option>
                                        <option value="September">September</option>
                                        <option value="Oktober">Oktober</option>
                                        <option value="November">November</option>
                                        <option value="Desember">Desember</option>
                                    </select>
                                </div>
                                <div>
                                    <label for="editPublishYear" class="block text-sm font-medium text-gray-700">Tahun Terbit</label>
                                    <input type="number" id="editPublishYear" required class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-orange-500 focus:ring focus:ring-orange-200 p-2 border" placeholder="2025">
                                </div>
                            </div>
                            
                            <div class="mb-4">
                                <label for="editPhone" class="block text-sm font-medium text-gray-700">No HP</label>
                                <input type="tel" id="editPhone" required class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-orange-500 focus:ring focus:ring-orange-200 p-2 border">
                            </div>

                            <div class="mb-4">
                                <label for="editPublicationType" class="block text-sm font-medium text-gray-700">Jenis Publikasi</label>
                                <select id="editPublicationType" required class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-orange-500 focus:ring focus:ring-orange-200 p-2 border">
                                    <option value="Reguler">Reguler (8 Hari) - 100rb</option>
                                    <option value="Fast Track">Fast Track (2 Hari) - 200rb</option>
                                </select>
                            </div>
                            
                            <div class="mb-4">
                                <label for="editJournalTarget" class="block text-sm font-medium text-gray-700">Jurnal yang Dituju</label>
                                <select id="editJournalTarget" required class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-orange-500 focus:ring focus:ring-orange-200 p-2 border">
                                    <option value="">Pilih Jurnal</option>
                                    <option value="EBISMEN">EBISMEN</option>
                                    <option value="WAWASAN">WAWASAN</option>
                                    <option value="PROFIT">PROFIT</option>
                                    <option value="POPULER">POPULER</option>
                                    <option value="SIDU">SIDU</option>
                                    <option value="INSDU">INSDU</option>
                                    <option value="OCEAN">OCEAN</option>
                                    <option value="KTI">KTI</option>
                                    <option value="SEJAHTERA">SEJAHTERA</option>
                                    <option value="KARUNIA">KARUNIA</option>
                                </select>
                            </div>
                            
                            <div class="mb-4">
                                <label for="editDeadline" class="block text-sm font-medium text-gray-700">Tanggal Deadline</label>
                                <input type="date" id="editDeadline" required class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-orange-500 focus:ring focus:ring-orange-200 p-2 border">
                            </div>
                            
                            <div class="mb-4">
                                <label class="block text-sm font-medium text-gray-700">Proses</label>
                                <div class="mt-2 space-y-2">
                                     <div class="flex items-center">
                                        <input id="editNotSubmitted" name="editProcess" type="radio" value="Belum submit" class="h-4 w-4 text-orange-600 focus:ring-orange-500">
                                        <label for="editNotSubmitted" class="ml-2 block text-sm text-gray-700">Belum submit</label>
                                    </div>
                                    <div class="flex items-center">
                                        <input id="editSubmitted" name="editProcess" type="radio" value="Sudah disubmit" class="h-4 w-4 text-orange-600 focus:ring-orange-500">
                                        <label for="editSubmitted" class="ml-2 block text-sm text-gray-700">Sudah disubmit</label>
                                    </div>
                                    <div class="flex items-center">
                                        <input id="editReview" name="editProcess" type="radio" value="Review" class="h-4 w-4 text-orange-600 focus:ring-orange-500">
                                        <label for="editReview" class="ml-2 block text-sm text-gray-700">Review</label>
                                    </div>
                                    <div class="flex items-center">
                                        <input id="editEditing" name="editProcess" type="radio" value="Editing" class="h-4 w-4 text-orange-600 focus:ring-orange-500">
                                        <label for="editEditing" class="ml-2 block text-sm text-gray-700">Editing</label>
                                    </div>
                                     <div class="flex items-center">
                                        <input id="editLoaTerbit" name="editProcess" type="radio" value="LoA sudah terbit" class="h-4 w-4 text-orange-600 focus:ring-orange-500">
                                        <label for="editLoaTerbit" class="ml-2 block text-sm text-gray-700">LoA sudah terbit</label>
                                    </div>
                                    <div class="flex items-center">
                                        <input id="editPublish" name="editProcess" type="radio" value="Publish" class="h-4 w-4 text-orange-600 focus:ring-orange-500">
                                        <label for="editPublish" class="ml-2 block text-sm text-gray-700">Publish</label>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="mb-4">
                                <label class="block text-sm font-medium text-gray-700">Status Pembayaran</label>
                                <div class="mt-2 space-y-2">
                                    <div class="flex items-center">
                                        <input id="editPaid" name="editPayment" type="radio" value="Sudah Bayar" class="h-4 w-4 text-orange-600 focus:ring-orange-500">
                                        <label for="editPaid" class="ml-2 block text-sm text-gray-700">Sudah Bayar</label>
                                    </div>
                                    <div class="flex items-center">
                                        <input id="editNotPaid" name="editPayment" type="radio" value="Belum Bayar" class="h-4 w-4 text-orange-600 focus:ring-orange-500">
                                        <label for="editNotPaid" class="ml-2 block text-sm text-gray-700">Belum Bayar</label>
                                    </div>
                                </div>
                            </div>

                             <!-- NEW Billing Timing Option for Edit -->
                             <div class="mb-4">
                                <label class="block text-sm font-medium text-gray-700">Waktu Penagihan</label>
                                <div class="mt-2 space-y-2">
                                    <div class="flex items-center">
                                        <input id="editBillNow" name="editBillingTiming" type="radio" value="Sekarang" checked class="h-4 w-4 text-orange-600 focus:ring-orange-500">
                                        <label for="editBillNow" class="ml-2 block text-sm text-gray-700">Sekarang</label>
                                    </div>
                                    <div class="flex items-center">
                                        <input id="editBillLater" name="editBillingTiming" type="radio" value="Nanti" class="h-4 w-4 text-orange-600 focus:ring-orange-500">
                                        <label for="editBillLater" class="ml-2 block text-sm text-gray-700">Nanti</label>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </form>
                </div>
                <div class="bg-gray-50 px-4 py-3 sm:px-6 sm:flex sm:flex-row-reverse">
                    <button type="button" id="saveEdit" class="w-full inline-flex justify-center rounded-md border border-transparent shadow-sm px-4 py-2 orange-gradient text-base font-medium text-white hover:opacity-90 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-orange-500 sm:ml-3 sm:w-auto sm:text-sm transition-opacity">
                        <i class="fas fa-save mr-2"></i> Simpan Perubahan
                    </button>
                    <button type="button" id="cancelEdit" class="mt-3 w-full inline-flex justify-center rounded-md border border-gray-300 shadow-sm px-4 py-2 bg-white text-base font-medium text-gray-700 hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-orange-500 sm:mt-0 sm:ml-3 sm:w-auto sm:text-sm">
                        <i class="fas fa-times mr-2"></i> Batal
                    </button>
                </div>
            </div>
        </div>
    </div>
    <div id="confirmModal" class="fixed inset-0 z-50 hidden overflow-y-auto">
        <div class="flex items-center justify-center min-h-screen pt-4 px-4 pb-20 text-center sm:block sm:p-0">
            <div class="fixed inset-0 transition-opacity" aria-hidden="true">
                <div class="absolute inset-0 bg-gray-500 opacity-75"></div>
            </div>
            <span class="hidden sm:inline-block sm:align-middle sm:h-screen" aria-hidden="true">&#8203;</span>
            <div class="inline-block align-bottom bg-white rounded-lg text-left overflow-hidden shadow-xl transform transition-all sm:my-8 sm:align-middle sm:max-w-lg sm:w-full">
                <div class="bg-white px-4 pt-5 pb-4 sm:p-6 sm:pb-4">
                    <div class="sm:flex sm:items-start">
                        <div class="mx-auto flex-shrink-0 flex items-center justify-center h-12 w-12 rounded-full bg-red-100 sm:mx-0 sm:h-10 sm:w-10">
                            <i class="fas fa-exclamation-triangle text-red-600"></i>
                        </div>
                        <div class="mt-3 text-center sm:mt-0 sm:ml-4 sm:text-left">
                            <h3 class="text-lg leading-6 font-medium text-gray-900" id="modalTitle">Konfirmasi Hapus</h3>
                            <div class="mt-2">
                                <p class="text-sm text-gray-500">Apakah Anda yakin ingin menghapus data jurnal ini? Tindakan ini tidak dapat dibatalkan.</p>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="bg-gray-50 px-4 py-3 sm:px-6 sm:flex sm:flex-row-reverse">
                    <button type="button" id="confirmDelete" class="w-full inline-flex justify-center rounded-md border border-transparent shadow-sm px-4 py-2 bg-red-600 text-base font-medium text-white hover:bg-red-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-red-500 sm:ml-3 sm:w-auto sm:text-sm">
                        <i class="fas fa-trash mr-2"></i> Ya, Hapus
                    </button>
                    <button type="button" id="cancelDelete" class="mt-3 w-full inline-flex justify-center rounded-md border border-gray-300 shadow-sm px-4 py-2 bg-white text-base font-medium text-gray-700 hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-orange-500 sm:mt-0 sm:ml-3 sm:w-auto sm:text-sm">
                        <i class="fas fa-times mr-2"></i> Batal
                    </button>
                </div>
            </div>
        </div>
    </div>
    <!-- Modal for Publish URL -->
    <div id="publishUrlModal" class="fixed inset-0 z-50 hidden overflow-y-auto">
        <div class="flex items-center justify-center min-h-screen pt-4 px-4 pb-20 text-center sm:block sm:p-0">
            <div class="fixed inset-0 transition-opacity" aria-hidden="true">
                <div class="absolute inset-0 bg-gray-500 opacity-75"></div>
            </div>
            <span class="hidden sm:inline-block sm:align-middle sm:h-screen" aria-hidden="true">&#8203;</span>
            <div class="inline-block align-bottom bg-white rounded-lg text-left overflow-hidden shadow-xl transform transition-all sm:my-8 sm:align-middle sm:max-w-lg sm:w-full">
                <div class="bg-white px-4 pt-5 pb-4 sm:p-6 sm:pb-4">
                    <div class="sm:flex sm:items-start">
                        <div class="mx-auto flex-shrink-0 flex items-center justify-center h-12 w-12 rounded-full bg-blue-100 sm:mx-0 sm:h-10 sm:w-10">
                            <i class="fas fa-link text-blue-600"></i>
                        </div>
                        <div class="mt-3 text-center sm:mt-0 sm:ml-4 sm:text-left w-full">
                            <h3 class="text-lg leading-6 font-medium text-gray-900">URL Artikel Terbit</h3>
                            <div class="mt-2">
                                <p class="text-sm text-gray-500 mb-2">Masukkan URL lengkap artikel yang sudah dipublikasikan.</p>
                                <input type="url" id="publishUrlInput" placeholder="https://..." class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-orange-500 focus:ring focus:ring-orange-200 p-2 border">
                            </div>
                        </div>
                    </div>
                </div>
                <div class="bg-gray-50 px-4 py-3 sm:px-6 sm:flex sm:flex-row-reverse">
                    <button type="button" id="savePublishUrl" class="w-full inline-flex justify-center rounded-md border border-transparent shadow-sm px-4 py-2 bg-blue-600 text-base font-medium text-white hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 sm:ml-3 sm:w-auto sm:text-sm">
                        <i class="fas fa-save mr-2"></i> Simpan URL
                    </button>
                    <button type="button" id="cancelPublishUrl" class="mt-3 w-full inline-flex justify-center rounded-md border border-gray-300 shadow-sm px-4 py-2 bg-white text-base font-medium text-gray-700 hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-orange-500 sm:mt-0 sm:ml-3 sm:w-auto sm:text-sm">
                        <i class="fas fa-times mr-2"></i> Batal
                    </button>
                </div>
            </div>
        </div>
    </div>
    <!-- Modal for LoA URL -->
    <div id="loaUrlModal" class="fixed inset-0 z-50 hidden overflow-y-auto">
        <div class="flex items-center justify-center min-h-screen pt-4 px-4 pb-20 text-center sm:block sm:p-0">
            <div class="fixed inset-0 transition-opacity" aria-hidden="true">
                <div class="absolute inset-0 bg-gray-500 opacity-75"></div>
            </div>
            <span class="hidden sm:inline-block sm:align-middle sm:h-screen" aria-hidden="true">&#8203;</span>
            <div class="inline-block align-bottom bg-white rounded-lg text-left overflow-hidden shadow-xl transform transition-all sm:my-8 sm:align-middle sm:max-w-lg sm:w-full">
                <div class="bg-white px-4 pt-5 pb-4 sm:p-6 sm:pb-4">
                    <div class="sm:flex sm:items-start">
                        <div class="mx-auto flex-shrink-0 flex items-center justify-center h-12 w-12 rounded-full bg-yellow-100 sm:mx-0 sm:h-10 sm:w-10">
                            <i class="fas fa-award text-yellow-600"></i>
                        </div>
                        <div class="mt-3 text-center sm:mt-0 sm:ml-4 sm:text-left w-full">
                            <h3 class="text-lg leading-6 font-medium text-gray-900">URL Letter of Acceptance (LoA)</h3>
                            <div class="mt-2">
                                <p class="text-sm text-gray-500 mb-2">Masukkan URL LoA dari Google Drive atau platform lain.</p>
                                <input type="url" id="loaUrlInput" placeholder="https://..." class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-orange-500 focus:ring focus:ring-orange-200 p-2 border">
                            </div>
                        </div>
                    </div>
                </div>
                <div class="bg-gray-50 px-4 py-3 sm:px-6 sm:flex sm:flex-row-reverse">
                    <button type="button" id="saveLoaUrl" class="w-full inline-flex justify-center rounded-md border border-transparent shadow-sm px-4 py-2 bg-yellow-600 text-base font-medium text-white hover:bg-yellow-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-yellow-500 sm:ml-3 sm:w-auto sm:text-sm">
                        <i class="fas fa-save mr-2"></i> Simpan URL LoA
                    </button>
                    <button type="button" id="cancelLoaUrl" class="mt-3 w-full inline-flex justify-center rounded-md border border-gray-300 shadow-sm px-4 py-2 bg-white text-base font-medium text-gray-700 hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-orange-500 sm:mt-0 sm:ml-3 sm:w-auto sm:text-sm">
                        <i class="fas fa-times mr-2"></i> Batal
                    </button>
                </div>
            </div>
        </div>
    </div>
    <!-- Modal for Invoice URL -->
    <div id="invoiceUrlModal" class="fixed inset-0 z-50 hidden overflow-y-auto">
        <div class="flex items-center justify-center min-h-screen pt-4 px-4 pb-20 text-center sm:block sm:p-0">
            <div class="fixed inset-0 transition-opacity" aria-hidden="true">
                <div class="absolute inset-0 bg-gray-500 opacity-75"></div>
            </div>
            <span class="hidden sm:inline-block sm:align-middle sm:h-screen" aria-hidden="true">&#8203;</span>
            <div class="inline-block align-bottom bg-white rounded-lg text-left overflow-hidden shadow-xl transform transition-all sm:my-8 sm:align-middle sm:max-w-lg sm:w-full">
                <div class="bg-white px-4 pt-5 pb-4 sm:p-6 sm:pb-4">
                    <div class="sm:flex sm:items-start">
                        <div class="mx-auto flex-shrink-0 flex items-center justify-center h-12 w-12 rounded-full bg-green-100 sm:mx-0 sm:h-10 sm:w-10">
                            <i class="fas fa-receipt text-green-600"></i>
                        </div>
                        <div class="mt-3 text-center sm:mt-0 sm:ml-4 sm:text-left w-full">
                            <h3 class="text-lg leading-6 font-medium text-gray-900">URL Invoice</h3>
                            <div class="mt-2">
                                <p class="text-sm text-gray-500 mb-2">Masukkan URL Invoice dari Google Drive atau platform lain.</p>
                                <input type="url" id="invoiceUrlInput" placeholder="https://..." class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-orange-500 focus:ring focus:ring-orange-200 p-2 border">
                            </div>
                        </div>
                    </div>
                </div>
                <div class="bg-gray-50 px-4 py-3 sm:px-6 sm:flex sm:flex-row-reverse">
                    <button type="button" id="saveInvoiceUrl" class="w-full inline-flex justify-center rounded-md border border-transparent shadow-sm px-4 py-2 bg-green-600 text-base font-medium text-white hover:bg-green-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-green-500 sm:ml-3 sm:w-auto sm:text-sm">
                        <i class="fas fa-save mr-2"></i> Simpan URL Invoice
                    </button>
                    <button type="button" id="cancelInvoiceUrl" class="mt-3 w-full inline-flex justify-center rounded-md border border-gray-300 shadow-sm px-4 py-2 bg-white text-base font-medium text-gray-700 hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-orange-500 sm:mt-0 sm:ml-3 sm:w-auto sm:text-sm">
                        <i class="fas fa-times mr-2"></i> Batal
                    </button>
                </div>
            </div>
        </div>
    </div>


    <!-- Footer -->
    <footer class="bg-orange-900 text-white py-6 mt-8">
        <div class="container mx-auto px-4">
            <div class="flex flex-col md:flex-row justify-between items-center">
                <div class="mb-4 md:mb-0">
                    <div class="flex items-center">
                        <i class="fas fa-book text-2xl mr-2"></i>
                        <span class="text-xl font-bold">Jeruk Manis ATS</span>
                    </div>
                    <p class="text-orange-200 mt-1">Aplikasi Khusus Buat Editor Jurnal</p>
                </div>
                <div class="flex space-x-4">
                    <a href="#" class="text-orange-200 hover:text-white">
                        <i class="fab fa-whatsapp text-xl"></i>
                    </a>
                    <a href="#" class="text-orange-200 hover:text-white">
                        <i class="fas fa-envelope text-xl"></i>
                    </a>
                    <a href="#" class="text-orange-200 hover:text-white">
                        <i class="fas fa-phone text-xl"></i>
                    </a>
                </div>
            </div>
            <div class="border-t border-orange-800 mt-4 pt-4 text-center text-orange-300 text-sm">
                &copy; 2025 Jeruk Manis ATS - Journal Tracker. All rights reserved.
            </div>
        </div>
    </footer>

    <!-- Using Firebase v9+ modular SDK -->
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/9.6.1/firebase-app.js";
        import { getDatabase, ref, push, onValue, update, remove, serverTimestamp } from "https://www.gstatic.com/firebasejs/9.6.1/firebase-database.js";

        // Firebase configuration
        const firebaseConfig = {
            apiKey: "AIzaSyAA5ylO4TMtGnnPhrm1vGUDF6AafNSrOUQ",
            authDomain: "orange-journal-tracker.firebaseapp.com",
            databaseURL: "https://orange-journal-tracker-default-rtdb.asia-southeast1.firebasedatabase.app",
            projectId: "orange-journal-tracker",
            storageBucket: "orange-journal-tracker.appspot.com",
            messagingSenderId: "430973783779",
            appId: "1:430973783779:web:bc1ccf3b75ce8144fcffd6"
        };

        // Initialize Firebase
        const app = initializeApp(firebaseConfig);
        const database = getDatabase(app);
        const journalsRef = ref(database, 'journals');

        // --- Global Variables ---
        let allJournalsData = {};
        const notifiedJournalIds = new Set();

        // --- DOM Elements ---
        const journalForm = document.getElementById('journalForm');
        const journalList = document.getElementById('journalList');
        const noData = document.getElementById('noData');
        const searchInput = document.getElementById('searchInput');
        const editModal = document.getElementById('editModal');
        const saveEdit = document.getElementById('saveEdit');
        const cancelEdit = document.getElementById('cancelEdit');
        const editId = document.getElementById('editId');
        const confirmModal = document.getElementById('confirmModal');
        const confirmDelete = document.getElementById('confirmDelete');
        const cancelDelete = document.getElementById('cancelDelete');
        const entryDateInput = document.getElementById('entryDate');
        const publicationTypeInput = document.getElementById('publicationType');
        const deadlineInput = document.getElementById('deadline');
        const editEntryDateInput = document.getElementById('editEntryDate');
        const editPublicationTypeInput = document.getElementById('editPublicationType');
        const editDeadlineInput = document.getElementById('editDeadline');
        const filterType = document.getElementById('filterType');
        const filterJournal = document.getElementById('filterJournal');
        const filterStatus = document.getElementById('filterStatus');
        const filterPayment = document.getElementById('filterPayment');
        const resetFiltersBtn = document.getElementById('resetFilters');
        
        const publishUrlModal = document.getElementById('publishUrlModal');
        const savePublishUrl = document.getElementById('savePublishUrl');
        const cancelPublishUrl = document.getElementById('cancelPublishUrl');
        const publishUrlInput = document.getElementById('publishUrlInput');

        const loaUrlModal = document.getElementById('loaUrlModal');
        const saveLoaUrl = document.getElementById('saveLoaUrl');
        const cancelLoaUrl = document.getElementById('cancelLoaUrl');
        const loaUrlInput = document.getElementById('loaUrlInput');

        const invoiceUrlModal = document.getElementById('invoiceUrlModal');
        const saveInvoiceUrl = document.getElementById('saveInvoiceUrl');
        const cancelInvoiceUrl = document.getElementById('cancelInvoiceUrl');
        const invoiceUrlInput = document.getElementById('invoiceUrlInput');
        
        // --- Functions ---
        
        function updateDeadline(entryDateElem, publicationTypeElem, deadlineElem) {
            const entryDateValue = entryDateElem.value;
            if (!entryDateValue) return;
            const entryDate = new Date(entryDateValue);
            const publicationType = publicationTypeElem.value;
            const daysToAdd = publicationType === 'Fast Track' ? 2 : 8;
            entryDate.setDate(entryDate.getDate() + daysToAdd);
            deadlineElem.value = entryDate.toISOString().split('T')[0];
        }

        function handleFormSubmit(e) {
            e.preventDefault();
            const newJournalData = {
                entryDate: document.getElementById('entryDate').value,
                authorName: document.getElementById('authorName').value,
                affiliation: document.getElementById('affiliation').value,
                title: document.getElementById('title').value,
                articleNumber: document.getElementById('articleNumber').value,
                volume: document.getElementById('volume').value,
                issueNumber: document.getElementById('issueNumber').value,
                publishMonth: document.getElementById('publishMonth').value,
                publishYear: document.getElementById('publishYear').value,
                phone: document.getElementById('phone').value,
                publicationType: document.getElementById('publicationType').value,
                journalTarget: document.getElementById('journalTarget').value,
                deadline: document.getElementById('deadline').value,
                process: document.querySelector('input[name="process"]:checked').value,
                payment: document.querySelector('input[name="payment"]:checked').value,
                billingTiming: document.querySelector('input[name="billingTiming"]:checked').value, // Add billingTiming
                createdAt: serverTimestamp(),
                publishedUrl: "",
                loaUrl: "",
                invoiceUrl: ""
            };
            push(journalsRef, newJournalData);
            journalForm.reset();
            document.getElementById('notSubmitted').checked = true;
            document.getElementById('notPaid').checked = true;
            document.getElementById('billNow').checked = true; // Reset billing timing to default
            initializeDateFields();
            alert('Data jurnal berhasil disimpan!');
        }

        function renderJournalList(snapshot) {
            const loadingSpinner = document.getElementById('loadingSpinner');
            loadingSpinner.classList.add('hidden');
            journalList.innerHTML = '';
            const journals = snapshot.val();
            allJournalsData = journals || {};
            if (!journals || Object.keys(journals).length === 0) {
                noData.classList.remove('hidden');
                return;
            }
            noData.classList.add('hidden');
            const journalsArray = Object.keys(journals).map(key => ({ id: key, ...journals[key] }));
            journalsArray.sort((a, b) => {
                const aIsDone = a.process === 'Publish';
                const bIsDone = b.process === 'Publish';
                if (aIsDone && !bIsDone) return 1;
                if (!aIsDone && bIsDone) return -1;
                return new Date(a.deadline).getTime() - new Date(b.deadline).getTime();
            });
            journalsArray.forEach(journal => {
                const row = createJournalRow(journal.id, journal);
                journalList.appendChild(row);
            });
            applyFilters();
        }

        function createJournalRow(key, journal) {
            const row = document.createElement('tr');
            row.className = 'hover:bg-orange-50 bg-white bg-opacity-90 transition-colors';
            row.dataset.id = key;
            row.dataset.author = journal.authorName.toLowerCase();
            row.dataset.title = journal.title.toLowerCase();
            row.dataset.articleNumber = journal.articleNumber ? journal.articleNumber.toLowerCase() : '';
            row.dataset.type = journal.publicationType;
            row.dataset.journal = journal.journalTarget;
            row.dataset.status = journal.process;
            row.dataset.payment = journal.payment;

            const today = new Date();
            today.setHours(0, 0, 0, 0);
            const deadlineDate = new Date(journal.deadline);
            const timeDiff = deadlineDate.getTime() - today.getTime();
            const daysDiff = Math.ceil(timeDiff / (1000 * 3600 * 24));
            const isUrgent = daysDiff <= 2 && daysDiff >= 0 && journal.process !== 'Publish';
            
            let statusClass = '';
            switch(journal.process) {
                case 'Sudah disubmit': statusClass = 'bg-blue-100 text-blue-800'; break;
                case 'Belum submit': statusClass = 'bg-gray-100 text-gray-800'; break;
                case 'Review': statusClass = 'bg-yellow-100 text-yellow-800'; break;
                case 'Editing': statusClass = 'bg-purple-100 text-purple-800'; break;
                case 'LoA sudah terbit': statusClass = 'bg-cyan-100 text-cyan-800'; break;
                case 'Publish': statusClass = 'bg-green-100 text-green-800'; break;
            }
            
            const paymentClass = journal.payment === 'Sudah Bayar' ? 'bg-green-100 text-green-800' : 'bg-red-100 text-red-800';
            const typeClass = journal.publicationType === 'Fast Track' ? 'bg-indigo-100 text-indigo-800' : 'bg-pink-100 text-pink-800';
            
            let deadlineCell = '';
            if (isUrgent) {
                deadlineCell = `<div class="flex items-center font-semibold text-red-600"><span class="mr-2">${journal.deadline}</span><span class="h-2 w-2 rounded-full bg-red-500 urgent"></span></div>`;
            } else if (daysDiff < 0 && journal.process !== 'Publish') {
                deadlineCell = `<div class="flex items-center text-red-500 font-semibold"><span class="mr-2">${journal.deadline}</span><span class="text-xs">(Terlewat)</span></div>`;
            } else {
                deadlineCell = journal.deadline;
            }
            
            // Published Article URL Actions + WhatsApp Button
            let publishUrlAction = '';
            let publishWaAction = ''; // New button for sending published info
            if (journal.process === 'Publish') {
                if (journal.publishedUrl) {
                    publishUrlAction = `
                        <div class="inline-flex items-center">
                            <a href="${journal.publishedUrl}" target="_blank" class="text-blue-600 hover:text-blue-900" title="Lihat Artikel Terbit"><i class="fas fa-external-link-alt"></i></a>
                            <button onclick="openPublishUrlModal('${key}')" class="ml-1 text-gray-500 hover:text-gray-800" title="Edit URL Terbit"><i class="fas fa-pencil-alt text-xs"></i></button>
                        </div>
                    `;
                    // Show WhatsApp button only if URL exists
                    publishWaAction = `<button onclick="sendPublishInfoViaWhatsApp('${key}')" class="text-blue-500 hover:text-blue-700" title="Kirim Info Artikel Terbit & Pembayaran via WhatsApp"><i class="fab fa-whatsapp"></i></button>`;
                } else {
                    publishUrlAction = `<button onclick="openPublishUrlModal('${key}')" class="text-gray-400 hover:text-gray-700" title="Masukkan URL Terbit"><i class="fas fa-link"></i></button>`;
                }
            }


            // LoA URL Actions + WhatsApp Button
            let loaActionHtml = '';
            let loaWaAction = ''; // Specific WhatsApp button for LoA/Invoice
            if (journal.loaUrl || journal.invoiceUrl) { // Check if either LoA or Invoice URL exists
                 loaWaAction = `<button onclick="sendLoaInvoiceViaWhatsApp('${key}')" class="text-green-500 hover:text-green-700" title="Kirim Info LoA/Invoice via WhatsApp"><i class="fab fa-whatsapp"></i></button>`;
            }
             if (journal.loaUrl) {
                 loaActionHtml = `
                    <div class="inline-flex items-center">
                        <a href="${journal.loaUrl}" target="_blank" class="text-yellow-600 hover:text-yellow-800" title="Buka URL LoA"><i class="fas fa-award"></i></a>
                        <button onclick="openLoaUrlModal('${key}')" class="ml-1 text-gray-500 hover:text-gray-800" title="Edit URL LoA"><i class="fas fa-pencil-alt text-xs"></i></button>
                    </div>
                `;
            } else {
                 loaActionHtml = `<button onclick="openLoaUrlModal('${key}')" class="text-gray-400 hover:text-gray-700" title="Tambahkan URL LoA"><i class="fas fa-award"></i></button>`;
            }

            // Invoice URL Actions
            let invoiceActionHtml = '';
            if (journal.invoiceUrl) {
                 invoiceActionHtml = `
                    <div class="inline-flex items-center">
                         <a href="${journal.invoiceUrl}" target="_blank" class="text-green-600 hover:text-green-800" title="Buka URL Invoice"><i class="fas fa-receipt"></i></a>
                         <button onclick="openInvoiceUrlModal('${key}')" class="ml-1 text-gray-500 hover:text-gray-800" title="Edit URL Invoice"><i class="fas fa-pencil-alt text-xs"></i></button>
                    </div>
                `;
            } else {
                 invoiceActionHtml = `<button onclick="openInvoiceUrlModal('${key}')" class="text-gray-400 hover:text-gray-700" title="Tambahkan URL Invoice"><i class="fas fa-receipt"></i></button>`;
            }


            row.innerHTML = `
                <td class="px-6 py-4 whitespace-nowrap">
                    <div class="flex items-center">
                        <div class="flex-shrink-0 h-10 w-10 rounded-full bg-orange-100 flex items-center justify-center"><i class="fas fa-user text-orange-500"></i></div>
                        <div class="ml-4">
                            <div class="text-sm font-medium text-gray-900">${journal.authorName}</div>
                            <div class="text-sm text-gray-500">${journal.affiliation}</div>
                        </div>
                    </div>
                </td>
                <td class="px-6 py-4">
                    <div class="text-sm text-gray-900 font-medium" title="${journal.title}">${journal.title.substring(0, 30)}${journal.title.length > 30 ? '...' : ''}</div>
                    <div class="text-xs text-gray-500 mt-1">No: ${journal.articleNumber || '-'}</div>
                </td>
                <td class="px-6 py-4 whitespace-nowrap">
                     <span class="px-2 inline-flex text-xs leading-5 font-semibold rounded-full ${typeClass}">${journal.publicationType}</span>
                </td>
                <td class="px-6 py-4 whitespace-nowrap">
                    <span class="px-2 inline-flex text-xs leading-5 font-semibold rounded-full bg-orange-100 text-orange-800">${journal.journalTarget}</span>
                </td>
                <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">${deadlineCell}</td>
                <td class="px-6 py-4 whitespace-nowrap">
                    <span class="px-2 inline-flex text-xs leading-5 font-semibold rounded-full ${statusClass}">${journal.process}</span>
                    <span class="mt-1 block px-2 inline-flex text-xs leading-5 font-semibold rounded-full ${paymentClass}">${journal.payment}</span>
                </td>
                <td class="px-6 py-4 whitespace-nowrap text-right text-sm font-medium">
                    <div class="flex space-x-2 items-center justify-end">
                        <button onclick="openEditModal('${key}')" class="text-orange-600 hover:text-orange-900" title="Edit Data"><i class="fas fa-edit"></i></button>
                        ${loaActionHtml}
                        ${invoiceActionHtml}
                        ${loaWaAction} <!-- WhatsApp for LoA/Invoice -->
                        ${publishUrlAction}
                        ${publishWaAction} <!-- WhatsApp for Published Article -->
                        <button onclick="showDeleteConfirm('${key}')" class="text-red-600 hover:text-red-900" title="Hapus"><i class="fas fa-trash"></i></button>
                    </div>
                </td>
            `;
            return row;
        }

        window.openEditModal = function(id) {
            const journalRef = ref(database, 'journals/' + id);
            onValue(journalRef, (snapshot) => {
                const journal = snapshot.val();
                if (!journal) return;
                editId.value = id;
                document.getElementById('editEntryDate').value = journal.entryDate;
                document.getElementById('editAuthorName').value = journal.authorName;
                document.getElementById('editAffiliation').value = journal.affiliation;
                document.getElementById('editTitle').value = journal.title;
                document.getElementById('editArticleNumber').value = journal.articleNumber || '';
                document.getElementById('editVolume').value = journal.volume || '';
                document.getElementById('editIssueNumber').value = journal.issueNumber || '';
                document.getElementById('editPublishMonth').value = journal.publishMonth || 'Januari';
                document.getElementById('editPublishYear').value = journal.publishYear || new Date().getFullYear();
                document.getElementById('editPhone').value = journal.phone;
                document.getElementById('editPublicationType').value = journal.publicationType || 'Reguler';
                document.getElementById('editJournalTarget').value = journal.journalTarget;
                document.getElementById('editDeadline').value = journal.deadline;
                document.querySelector(`input[name="editProcess"][value="${journal.process}"]`).checked = true;
                document.querySelector(`input[name="editPayment"][value="${journal.payment}"]`).checked = true;
                
                // Set billing timing value in edit modal
                const billingTimingValue = journal.billingTiming || "Sekarang"; // Default if not set
                const billingRadio = document.querySelector(`input[name="editBillingTiming"][value="${billingTimingValue}"]`);
                if (billingRadio) billingRadio.checked = true;
                
                editModal.classList.remove('hidden');
            }, { onlyOnce: true });
        }

        function handleSaveEdit() {
            const id = editId.value;
            const journalRef = ref(database, 'journals/' + id);
            const updatedData = {
                entryDate: document.getElementById('editEntryDate').value,
                authorName: document.getElementById('editAuthorName').value,
                affiliation: document.getElementById('editAffiliation').value,
                title: document.getElementById('editTitle').value,
                articleNumber: document.getElementById('editArticleNumber').value,
                volume: document.getElementById('editVolume').value,
                issueNumber: document.getElementById('editIssueNumber').value,
                publishMonth: document.getElementById('editPublishMonth').value,
                publishYear: document.getElementById('editPublishYear').value,
                phone: document.getElementById('editPhone').value,
                publicationType: document.getElementById('editPublicationType').value,
                journalTarget: document.getElementById('editJournalTarget').value,
                deadline: document.getElementById('editDeadline').value,
                process: document.querySelector('input[name="editProcess"]:checked').value,
                payment: document.querySelector('input[name="editPayment"]:checked').value,
                billingTiming: document.querySelector('input[name="editBillingTiming"]:checked').value // Save billing timing from edit
                // Keep existing URLs (loaUrl, invoiceUrl, publishedUrl) by not including them here
                // Firebase update only modifies fields present in updatedData
            };
            update(journalRef, updatedData).then(() => {
                editModal.classList.add('hidden');
                alert('Data berhasil diperbarui!');
            }).catch(error => alert('Gagal memperbarui data: ' + error.message));
        }

        window.showDeleteConfirm = function(id) {
            confirmModal.dataset.id = id;
            confirmModal.classList.remove('hidden');
        }

        function handleDeleteConfirm() {
            const id = confirmModal.dataset.id;
            const journalRef = ref(database, 'journals/' + id);
            remove(journalRef).then(() => {
                confirmModal.classList.add('hidden');
                alert('Data berhasil dihapus!');
            }).catch(error => alert('Gagal menghapus data: ' + error.message));
        }

        function applyFilters() {
            const searchTerm = searchInput.value.toLowerCase();
            const typeFilter = filterType.value;
            const journalFilter = filterJournal.value;
            const statusFilter = filterStatus.value;
            const paymentFilter = filterPayment.value;
            const rows = journalList.querySelectorAll('tr');
            rows.forEach(row => {
                const searchMatch = row.dataset.author.includes(searchTerm) || row.dataset.title.includes(searchTerm) || row.dataset.articleNumber.includes(searchTerm);
                const typeMatch = !typeFilter || row.dataset.type === typeFilter;
                const journalMatch = !journalFilter || row.dataset.journal === journalFilter;
                const statusMatch = !statusFilter || row.dataset.status === statusFilter;
                const paymentMatch = !paymentFilter || row.dataset.payment === paymentFilter;
                row.style.display = (searchMatch && typeMatch && journalMatch && statusMatch && paymentMatch) ? '' : 'none';
            });
        }
        
        // --- URL Modal Functions ---
        function openUrlModal(modalElement, inputElement, id, urlField) {
             const journalRef = ref(database, 'journals/' + id);
            onValue(journalRef, (snapshot) => {
                const journal = snapshot.val();
                inputElement.value = (journal && journal[urlField]) ? journal[urlField] : '';
                modalElement.dataset.id = id;
                modalElement.dataset.field = urlField; // Store which field this modal is for
                modalElement.classList.remove('hidden');
            }, { onlyOnce: true });
        }

        function handleSaveUrl(modalElement, inputElement) {
            const id = modalElement.dataset.id;
            const field = modalElement.dataset.field;
            const url = inputElement.value.trim();

            if (!id || !field) return;
            if (!url) {
                alert('URL tidak boleh kosong.');
                return;
            }
             try {
                new URL(url);
            } catch (_) {
                alert('Format URL tidak valid. Pastikan menggunakan http:// atau https://');
                return;
            }

            const journalRef = ref(database, 'journals/' + id);
            const updateData = {};
            updateData[field] = url; // Dynamically set the field to update

            update(journalRef, updateData)
                .then(() => {
                    modalElement.classList.add('hidden');
                    alert(`URL ${field.replace('Url','')} berhasil disimpan!`);
                })
                .catch(error => {
                    alert(`Gagal menyimpan URL ${field.replace('Url','')}: ${error.message}`);
                });
        }

        // --- Specific URL Modal Openers ---
        window.openPublishUrlModal = (id) => openUrlModal(publishUrlModal, publishUrlInput, id, 'publishedUrl');
        window.openLoaUrlModal = (id) => openUrlModal(loaUrlModal, loaUrlInput, id, 'loaUrl');
        window.openInvoiceUrlModal = (id) => openUrlModal(invoiceUrlModal, invoiceUrlInput, id, 'invoiceUrl');
        
        // --- Specific URL Modal Savers ---
        savePublishUrl.addEventListener('click', () => handleSaveUrl(publishUrlModal, publishUrlInput));
        saveLoaUrl.addEventListener('click', () => handleSaveUrl(loaUrlModal, loaUrlInput));
        saveInvoiceUrl.addEventListener('click', () => handleSaveUrl(invoiceUrlModal, invoiceUrlInput));

        // --- Specific URL Modal Cancellers ---
        cancelPublishUrl.addEventListener('click', () => publishUrlModal.classList.add('hidden'));
        cancelLoaUrl.addEventListener('click', () => loaUrlModal.classList.add('hidden'));
        cancelInvoiceUrl.addEventListener('click', () => invoiceUrlModal.classList.add('hidden'));

        // --- Defined Functions for Event Listeners ---
        function handleSavePublishUrl() {
            handleSaveUrl(publishUrlModal, publishUrlInput);
        }

        function handleSaveLoaUrl() {
            handleSaveUrl(loaUrlModal, loaUrlInput);
        }

        function handleSaveInvoiceUrl() {
            handleSaveUrl(invoiceUrlModal, invoiceUrlInput);
        }

        // --- WhatsApp Functions ---
        window.sendLoaInvoiceViaWhatsApp = function(id) { // Renamed for clarity
            const journal = allJournalsData[id];
            if (!journal || !journal.phone) {
                alert("No HP penulis tidak ditemukan.");
                return;
            }
            if (!journal.loaUrl && !journal.invoiceUrl) {
                alert("URL LoA dan URL Invoice belum ditambahkan.");
                return;
            }

            const phoneNumber = journal.phone.replace(/^0/, '62');
            let message = `Yth. ${journal.authorName},\n\nBerikut kami sampaikan LoA (Letter of Acceptance) dari artikel yang berjudul "${journal.title}".\n`;
            
            if (journal.loaUrl) {
                message += `\nLoA:\n${journal.loaUrl}\n`;
            }

            if (journal.invoiceUrl) {
                message += `\nUntuk informasi pembayaran, silakan akses invoice pada tautan berikut:\n${journal.invoiceUrl}\n`;
            }

            // Logic for 'Sekarang' Billing Timing inside sendLoaInvoiceViaWhatsApp
            if (journal.payment === 'Belum Bayar' && journal.billingTiming === 'Sekarang') {
                const price = journal.publicationType === 'Fast Track' ? '200.000' : '100.000';
                message += `\nSelanjutnya, mohon dapat menyelesaikan administrasi pembayaran sebesar Rp ${price} melalui:\n`;
                message += `- DANA: 089667747299\n`;
                message += `- Bank Mandiri: 1360034498730 (a.n Dhanan)\n`;
            }


            message += `\nTerima kasih.\nTim Editor Jurnal ${journal.journalTarget}`;

            const encodedMessage = encodeURIComponent(message);
            const waUrl = `https://wa.me/${phoneNumber}?text=${encodedMessage}`;
            window.open(waUrl, '_blank');
        }

        window.sendPublishInfoViaWhatsApp = function(id) { // New function
            const journal = allJournalsData[id];
            if (!journal || !journal.phone) {
                alert("No HP penulis tidak ditemukan.");
                return;
            }
            if (!journal.publishedUrl) {
                alert("URL Artikel Terbit belum ditambahkan.");
                return;
            }

            const phoneNumber = journal.phone.replace(/^0/, '62');
            let message = `Yth. ${journal.authorName},\n\nArtikel Anda yang berjudul "${journal.title}" telah terbit.\n`;
            message += `\nLink Artikel:\n${journal.publishedUrl}\n`;

            // Logic for 'Nanti' Billing Timing inside sendPublishInfoViaWhatsApp (implicitly NOT 'Sekarang', or specifically 'Nanti')
            // If the user chose 'Nanti', they expect to bill at publish time.
            if (journal.payment === 'Belum Bayar' && journal.billingTiming === 'Nanti') {
                const price = journal.publicationType === 'Fast Track' ? '200.000' : '100.000';
                message += `\nSelanjutnya, mohon dapat menyelesaikan administrasi pembayaran sebesar Rp ${price} melalui:\n`;
                message += `- DANA: 089667747299\n`;
                message += `- Bank Mandiri: 1360034498730 (a.n Dhanan)\n`;
            }

            message += `\nTerima kasih.\nTim Editor Jurnal ${journal.journalTarget}`;

            const encodedMessage = encodeURIComponent(message);
            const waUrl = `https://wa.me/${phoneNumber}?text=${encodedMessage}`;
            window.open(waUrl, '_blank');
        }


        // --- Notification Functions (Browser-based) ---
        
        function checkNotificationPermission() {
            const notificationBtn = document.getElementById('notificationBtn');
            if (!('Notification' in window)) {
                notificationBtn.style.display = 'none';
                return;
            }
            if (Notification.permission === 'granted') {
                notificationBtn.classList.remove('text-white');
                notificationBtn.classList.add('text-green-300');
                notificationBtn.title = "Notifikasi sudah aktif";
            } else if (Notification.permission === 'denied') {
                notificationBtn.classList.remove('text-white');
                notificationBtn.classList.add('text-red-400');
                notificationBtn.title = "Notifikasi diblokir. Izinkan di pengaturan browser.";
            }
        }

        function requestNotificationPermission() {
            if (!('Notification' in window)) {
                alert('Browser ini tidak mendukung notifikasi desktop.');
                return;
            }

            if (Notification.permission === 'granted') {
                alert('Notifikasi sudah diizinkan.');
                return;
            }
            
            Notification.requestPermission().then(permission => {
                if (permission === 'granted') {
                    console.log('Izin notifikasi diberikan.');
                    new Notification('Jeruk Manis ATS', {
                        body: 'Notifikasi berhasil diaktifkan!',
                        icon: 'https://img.icons8.com/?size=100&id=XxRdzBNPGyUO&format=png&color=000000'
                    });
                } else {
                    alert('Anda menolak izin notifikasi.');
                }
                checkNotificationPermission();
            });
        }

        function checkDeadlinesForNotifications() {
            if (Notification.permission !== 'granted') return;

            const journals = allJournalsData;
            if (!journals) return;

            const today = new Date();
            today.setHours(0, 0, 0, 0);

            Object.keys(journals).forEach(key => {
                const journal = journals[key];
                
                if (journal.process === 'Publish' || notifiedJournalIds.has(key)) {
                    return;
                }

                const deadlineDate = new Date(journal.deadline);
                const timeDiff = deadlineDate.getTime() - today.getTime();
                const daysDiff = Math.ceil(timeDiff / (1000 * 3600 * 24));
                
                if (daysDiff <= 2 && daysDiff >= 0) {
                    const deadlineText = daysDiff === 0 ? 'hari ini' : `dalam ${daysDiff} hari`;
                    const title = ` Deadline Mendekat: ${journal.journalTarget}`;
                    const body = `Artikel "${journal.title.substring(0,40)}..." oleh ${journal.authorName} akan jatuh tempo ${deadlineText}.`;
                    
                    new Notification(title, { body: body, icon: 'https://img.icons8.com/?size=100&id=XxRdzBNPGyUO&format=png&color=000000' });
                    notifiedJournalIds.add(key);
                }
            });
        }

        function initializeDateFields() {
            const today = new Date();
            const year = today.getFullYear();
            const monthNames = ["Januari", "Februari", "Maret", "April", "Mei", "Juni", "Juli", "Agustus", "September", "Oktober", "November", "Desember"];
            entryDateInput.value = today.toISOString().split('T')[0];
            document.getElementById('publishYear').value = year;
            document.getElementById('publishMonth').value = monthNames[today.getMonth()];
            updateDeadline(entryDateInput, publicationTypeInput, deadlineInput);
        }

        // --- Event Listeners ---
        journalForm.addEventListener('submit', handleFormSubmit);
        saveEdit.addEventListener('click', handleSaveEdit);
        confirmDelete.addEventListener('click', handleDeleteConfirm);
        cancelDelete.addEventListener('click', () => confirmModal.classList.add('hidden'));
        cancelEdit.addEventListener('click', () => editModal.classList.add('hidden'));
        entryDateInput.addEventListener('change', () => updateDeadline(entryDateInput, publicationTypeInput, deadlineInput));
        publicationTypeInput.addEventListener('change', () => updateDeadline(entryDateInput, publicationTypeInput, deadlineInput));
        editEntryDateInput.addEventListener('change', () => updateDeadline(editEntryDateInput, editPublicationTypeInput, editDeadlineInput));
        editPublicationTypeInput.addEventListener('change', () => updateDeadline(editEntryDateInput, editPublicationTypeInput, editDeadlineInput));
        searchInput.addEventListener('input', applyFilters);
        filterType.addEventListener('change', applyFilters);
        filterJournal.addEventListener('change', applyFilters);
        filterStatus.addEventListener('change', applyFilters);
        filterPayment.addEventListener('change', applyFilters);
        resetFiltersBtn.addEventListener('click', () => {
            searchInput.value = ''; filterType.value = ''; filterJournal.value = ''; filterStatus.value = ''; filterPayment.value = '';
            applyFilters();
        });
        savePublishUrl.addEventListener('click', handleSavePublishUrl);
        cancelPublishUrl.addEventListener('click', () => publishUrlModal.classList.add('hidden'));
        saveLoaUrl.addEventListener('click', handleSaveLoaUrl);
        cancelLoaUrl.addEventListener('click', () => loaUrlModal.classList.add('hidden'));
        saveInvoiceUrl.addEventListener('click', handleSaveInvoiceUrl);
        cancelInvoiceUrl.addEventListener('click', () => invoiceUrlModal.classList.add('hidden'));


        // --- Notification Setup ---
        const notificationBtn = document.getElementById('notificationBtn');
        notificationBtn.addEventListener('click', requestNotificationPermission);
        checkNotificationPermission();
        
        // Check deadlines every 60 seconds
        setInterval(checkDeadlinesForNotifications, 60000);

        // Initial data load from Firebase
        document.getElementById('loadingSpinner').classList.remove('hidden');
        document.getElementById('noData').classList.add('hidden');
        onValue(journalsRef, renderJournalList, (error) => {
            console.error("Firebase read failed: " + error.name, error);
            document.getElementById('loadingSpinner').classList.add('hidden');
            const noDataElement = document.getElementById('noData');
            noDataElement.classList.remove('hidden');
            noDataElement.querySelector('h3').textContent = 'Gagal Memuat Data';
            noDataElement.querySelector('p').textContent = 'Periksa koneksi internet Anda atau hubungi administrator.';
            alert("Gagal memuat data dari database. Periksa log konsol untuk detail.");
        });
        
        window.onload = initializeDateFields;
    </script>
</body>
</html>
